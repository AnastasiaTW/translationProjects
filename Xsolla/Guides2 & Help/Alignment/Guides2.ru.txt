Xsolla Login

Xsolla Login — система, предназначенная для разработчиков игр и приложений. В рамках подключения к Xsolla Login создается специальное приложение, позволяющее упростить процесс регистрации новых пользователей в игре, если они уже имеют учетную запись в социальных сетях. Кроме этого, с согласия пользователей, возможно получить доступ к информации из профиля в социальной сети для более глубокой интеграции с проектом.

Руководство по интеграции

Подготовка к работе

Для начала работы необходимо зарегистрировать приложение, написав письмо на [bizdev@xsolla.com](mailto:bizdev@xsolla.com).

В письме необходимо указать:

*   **Сайт** — адрес сайта игры, к которому планируется подключить Xsolla Login, например ht<span>tp://mysite.com</span>.
*   **Базовый домен** — базовый домен сайта, например, mysite.com. Можно указать несколько доменных имен, и, если есть необходимость, использовать один _projectId_ на разных доменах.
*   **Список способов аутентификации** — список возможных способов аутентификации. Доступные варианты:
    *   аутентификация через логин/пароль,
    *   через SMS,
    *   социальные сети ((Facebook, Twitter, Steam, Twitch, VK, Naver, и т.д.),
    *   i-pin (BETA),
    *   многофакторная аутентификация (BETA),
    *   сертификат (BETA)
    *   локальные социальные сети (BETA).

Также необходимо указать список социальных сетей, через которые должна быть доступна аутентификация.

В ответном письме мы пришлем вам _projectId_ и _secretKey_.

<aside class="warning">Обратите внимание, вызовы методов Xsolla Login можно осуществлять только на страницах с URL, принадлежащим базовому домену.</aside>

Виджет аутентификации

Рассмотренный ниже пример добавляет виджет аутентификации стандартного вида. Вы можете настроить внешний вид блоков при помощи css. Шаблон SCSS доступен для скачивания по [ссылке](../files/xl-scss.zip).

По умолчанию ширина блока 400px, высота зависит от аутентификационных опций.

[![Example of a default design](1)
Подключение виджета

Для добавления виджета аутентификации Xsolla Login в игру, выполните следующие шаги:

1.  В тег <head> добавьте подключение js-sdk.js:

    <script src="https://static.xsolla.com/xsolla-login/1.1.1/xl.min.js"></script>

1.  В тег <body> добавьте код для инициализации:

    <script type="text/javascript">
    XL.init({
             projectId: '40db2ea4-5p47-11e6-a3ff-005056a0e04a',
             locale: 'en_US',
             onlyWidgets: true,
             redirectUrl: '<your redirect url>',
             fields: 'email'
         });
    </script>







**Название**

**Тип**

**Описание**









projectId

string

Идентификатор приложения. **Обязательный**.





locale

string

Локаль пользователя в формате <language code>_<country code>, где:

*   _language code:_ код языка в формате [ISO 639 alpha-2](https://en.wikipedia.org/wiki/List_of_ISO_639-2_codes);
*   _country code:_ код страны (региона) в формате [ISO 3166-1 alpha-2](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2).







redirectUrl

string

Адрес, на который следует перенаправить пользователя после аутентификации. [Передается в jwt-токене.](#server_side)





onlyWidgets

boolean

Инициализировать ли Xsolla Login только для подключения виджетов. 'true' по умолчанию.





preloader

string

Прелоадер, который будет показан до загрузки виджета. Необходимо указать html-код элемента.





fields

string

Данные, которые необходимо получить от пользователя. Допустимое значение: email. **Обязательный**







1.  Добавьте элемент DIV, в котором будет отображаться виджет, задайте ему уникальный id, и добавьте после него код инициализации виджета.

    <div id="xl_auth"></div>
    <script type="text/javascript">
    var element_id = 'xl_auth';
    var options = {
        width: '200px',
        height: '200px'
    };
    XL.AuthWidget(element_id, options);
    </script>







**Название**

**Тип**

**Описание**









element_id

string

id элемента-контейнера для блока аутентификации. **Обязательный**





options

object

Настройки блока с виджетом.





options.width

string

Ширина блока.





options.height

string

Высота блока.







Xsolla Login Server Side

Схема взаимодействия

<button class="scheme-toggler" id="scheme_toggler">Показать всю схему</button>

Callback URL

URL, на который происходит перенаправление пользователя в браузере в конце процесса аутенификации.

Прохождение аутентификации. Успех

В случае успеха пользователь будет переадресован на Ваш callback URL со следующим параметром:

**HTTP запрос**

`GET https://callBackUrl.php?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ`







Параметр

Тип

Описание









token

string

[JWT-token](https://en.wikipedia.org/wiki/JSON_Web_Token). Вы можете [дешифровать его](https://jwt.io), используя секретный ключ.





is_linking

boolean

Пользователь прилинковал аккаунт.







Пример дешифрованного токена

    {
      "exp": 1471071785,
      "iss": "https://login.xsolla.com",
      "iat": 1470985385,
      "id": "11111111",
      "name": "John Carter",
      "email": "john@example.com",
      "type": "social",
      "provider": "social_network",
      "xsolla_login_access_key": "s4dGNSPKinUxkSRI8rhPhZRElHj2yusqEeqgLIgn"
    }







Параметр

Тип

Описание









exp

string

Дата окончания действия токена. (Unix time)





iss

string

Указание, кто выдал JWT-token.





iat

string

Дата создания. (Unix time)





id

string

Идентификатор пользователя.





name

string

Полное имя пользователя.





email

string

email пользователя.





type

string

Тип аутентификации. Допустимые значения: "proxy" — проксированная аутентификация; "social" — вход через социальную сеть.





provider

string

Название социальной сети. Список допустимых значений: "vk", "facebook", "twitter", "steam", "baidu", "naver", "qq", "github", "microsoft", "linkedin", "google".





xsolla_login_access_key

string

Ключ доступа для вызова методов от имени пользователя.







Прохождение аутентификации. Ошибка

В случае ошибки, пользователь будет перенаправлен на Ваш callback URL со следующими [параметрами:](1)
**HTTP запрос**

`GET https://callBackUrl.php?error=003-002&error_description=User+not+found&redirect_url=https://site.com/fail_url`







Параметр

Тип

Описание









error

string

Группа кодов ошибок.





error_description

string

Описание ошибки.





redirect_url

string

Callback URL проекта.







Дополнительные методы API

Проксированная аутентификация может быть использована в том случае, если у Вас уже есть база пользователей. В этом случае необходимо реализовать следующие методы:

Xsolla Login будет вызывать методы с адресов [https://login.xsolla.com/](1)
Проверка логина/пароля

*   Тип: POST
*   Content-type: application/json
*   Тело запроса: _{"username":"ХХХХ", "password":"ХХХХ"}_
*   Успех: _{Ok 200}_
*   Неудачный запрос: _{"error": {"code": “003-001”, "description": "" }}_

Регистрация

*   Тип: POST
*   Content-type: application/json
*   Тело запроса: _{"username":"ХХХХ", "password":"ХХХХ", "email":"ХХХХ"}_
*   Успех: _{Ok 200}_
*   Неудачный запрос: _{error: {code: “003-003|004”, description: “” }}_

Сброс пароля

*   Тип: POST
*   Content-type: application/json
*   Тело запроса: _{"email":"ХХХХ"}_
*   Успех: _{Ok 200}_
*   Неудачный запрос: _{"error": {"code": “003-002”, "description": ""}}_

Xsolla Data Portal на базе Slemma

Этот гайд поможет вам ориентироваться в нашем [демо-примере](https://slemma.com/demo/xsolla-payments), и лучше понимать, как вы можете использовать данные отчеты при работе с вашей платежной аналитикой в [Личном Кабинете](https://publisher.xsolla.com). Ниже представлена информация о том как анализировать [дашборды](#dashboards), описания ко всем разделам, определения для различных [метрик](#dataset-measures) и [измерений](#dataset_dimensions), а также список [Вопросов](#faq_data_portal). Если у вас возникнут вопросы, напишите нам на [dataportal@xsolla.com](mailto:dataportal@xsolla.com)!

Дашборды

Дашборд — это набор графиков и диаграмм, дающих вам возможность глубже анализировать конкретную проблему. Каждый из дашбордов позволит вам увеличить значения о какой-либо области деятельности вашей компании и принимать решения на основе анализируемых данных.

[![Общая информаци](1)
Основные понятия

Фильтры

Для каждого дашборда есть несколько фильтров, расположенных в верхней части страницы, которые позволяют вам фильтровать данные по разным [измерениям](#dataset_dimensions). Чтобы использовать эти фильтры, выберите один и установите флажки измерений, по которым вы бы хотели ограничить выборку. Например, если в фильтре **User Country** выбрать _United States_, то на дашборде будут показаны данные о платежах только из _United States_. Чтобы исключить данные из выборки, используйте режим 'Exclude' в меню фильтра (меню появляется при нажатии на три точки справа от названия фильтра). Используйте фильтры, чтобы "углубиться" в данные об игре.

Значения показателей роста

Показатели роста сравнивают текущее состояние выбранных [метрик](#dataset_measures) с метриками за предыдущий период такой же длины. Зеленые, направленные вверх стрелки указывают на рост по сравнению с предыдущим периодом, а красные, направленные вниз стрелки означают падение.

Значения по выбранному периоду

В отличие от значений, которые показывают лишь агрегированные данные за выбранный период, эти значения корректируются на основе периода времени, установленного в фильтре **Date**. Используйте этот фильтр для изменения агрегированного периода времени на дашборде, и эти значения также изменятся.

Среднесуточные значения

В отличие от обычных значений, среднесуточные значения не будут увеличиваться при увеличении периода. Например, **ARPPU** будет расти при увеличении периода, потому что те же пользователи будут продолжать платить. Усредненный доход на платящего ежедневно активного пользователя (ARPPDAU) не будет расти, так как это среднее значение от всех средних значений за период, а не от общего количества платежей и среднего количества платящих пользователей.

Агрегация по неделям и месяцам

Если вы выберите определенный период в фильтре **Date**, например 4 недели, то данные будут показаны, разделенные по неделям и показывать 4 недели. Агрегация данных за эти недели будет на основе всей активности за эти недели, а не средней от средних данных за день, которая будет показана, когда выбран фильтр по дням.

Параллельный период

Графики параллельного периода позволят вам сделать анализ тренда.

Скользящая средняя

Скользящая средняя является еще одним способом анализа тенденций. Временные рамки, используемые в расчетах, отображаются в названии метрик. Естественно, длительные временные отрезки дадут меньшую волатильность и покажут общую тенденцию рассматриваемого периода. Мы используем простую скользящую среднюю.

Скачать любой график в excel

При необходимости вы можете загрузить данные непосредственно из диаграммы. Щелкните правой кнопкой мыши по графику и загрузите данные в формате CSV, XLS, а также в PNG для использования в презентациях.

Справочник дашбордов

Обзорный

Обзорный дашборд содержит KPI вашей игры, идеален для ежедневного анализа, а также для показа на вашем офисном TV. Включает **Gross Revenue**, **Payments**, **Paying Users**, **ARPPU**, **Paid Invoices** и **Average Payment Amount**.

Игры

Игровой дашборд создан для анализа различных платежных ситуаций в ваших играх. Метрики заложены вместе с регулярными фильтрами, так что вы можете определить приоритеты и оценить разницу между вашими проектами.

Платежные системы

Понимание того, как платят ваши пользователи может быть столь же важным, как и ответ на вопрос: "почему?". Данный дашборд должен помочь вам понять как различные подгруппы ваших пользователей совершают платежи и как вы можете оптимизировать свой сайт, показывая наиболее подходящие и наиболее популярные платежные системы.

Кредитные карты

Дашборд кредитных карт полностью посвящен данным о кредитных картах. Анализ конверсии, причины отказа, а также информация о том как много пользователей разрешили Xsolla сохранить их платежные данные для будущих покупок (надежный индикатор их намерения еще вернуться в игру)!

Revenue

Revenue-дашборд предлагает несколько различных способов анализа тенденций. В данный дашборд включены параллельные периоды, средняя скользящая и диаграммы роста, все они могут помочь вам строить прогнозы. Также дашборд содержит лист валют; вы можете убедиться, что предлагаете все валюты, соответствующие областям присутствия ваших проектов.

Платящие пользователи

Paying Users дашборд — это способ понять характеристики вашего **Revenue**. Если **Revenue** увеличивается вы можете задать вопрос: новые пользователи становятся **Paying Users** или **Existing Paying Users** платят больше?

ARPPU

Average Revenue Per Paying User (ARPPU) это еще один способ увидеть характерное платежное поведение ваших пользователей. Данный дашборд также включает единичные значения Average Revenue Per Paying Daily Active User, который не увеличивается с течением времени от пользователей, совершивших единичный платеж.

Виртуальная валюта

Дашборд виртуальной валюты будет информировать вас о том как много пользователей совершили покупки, расплатившись внутриигровой валютой. Также вы можете загрузить ваши внутриигровые данные о потраченной игровой валюте, создать сравнительный дашборд и проверить здоровье вашей внутриигровой экономики.

География

Дашборд поможет понять разницу между платежными привычками пользователей в зависимости от их местоположения. Каждый лист сгруппирован по различным признакам, включая такие как: **Countries**, **Regions**, **Languages**, **Business Regions** и **Timezones**.

Девайсы

Дашборд включает информацию об опыте пользователя в вашем интерфейсе. Вы можете использовать данную информацию для оптимизации вашего сайта для наиболее популярных девайсов и быть уверенным, что он работает в самых распространенных браузерах.

Отмены

Дашборд позволит вам следить за фродом в вашей игре. Обзор листов будет показывать число отмен в **Cancellation Date**, **Payment Date**, как в процентах, так и географически. Список причин даст вам возможность увидеть распределение причин отмены для каждой отмены.

Xsolla Dataset

Все эти предустановленные дашборды действительно хороши, но что если вы хотите создать свой собственный? Вы можете сделать это с помощью предоставленного Xsolla Dataset! Вы можете создать неограниченное количество дашбордов с вашим [Slemma](https://slemma.com)-аккаунтом и вашими данными; постройте любой график с любыми метриками или измерениями.

Измерения

Измерения отличаются от данных. Это не сами значения, но определенные категории значений. Всякий раз, когда вы используете фильтр, вы фильтруете данные по измерению.

Примеры измерений: **Countr**y, **Credit Card Type**, **Date**, и.т.д.







Группа

Название

Описание









DateTime

**Date**

Дата по умолчанию для всех графиков в часовом поясе формата UTC. Данная дата основывается на последнем обновлении платежного статуса (invoice, payment, cancellation). Пример: когда вы хотите добавить платежи или отмены на единую временную шкалу, платежи будут агрегироваться по дате платежа, отмены — по дате отмены.





DateTime

**Invoice Date**

Дата создания заявки в UTC .





DateTime

**Payment Date**

Дата подтверждения платежа в UTC. Данная дата доступна только для завершенных платежей и не доступна для неоплаченных заявок.





DateTime

**Cancellation Date**

Дата отмены платежа в UTC. Данные доступны для отмененных платежей.





Projects

**Project**

ID пректа и название проекта





Payment System

**Payment System Group**

Группа платежных систем, например: _Cash Payments_, _Bank Transfer_





Payment System

**Payment System**

ID платежной системы и название, например: _24\. Paypal_, _57\. PaySafeCard_





Geography

**User Country**

Страна пользователя, определена системой Xsolla. Вычисленная страна является наиболее точной и подходящей. IP-адрес пользователя, страна мобильного оператора, страна банка, выпустившего кредитную карту и другие атрибуты используются для определения страны. Данная страна используется для внутренних вычислений VAT.





Geography

**Language**

Язык. Используется 2-буквенный код, вида _EN_, _PT_, _RU_





Geography

**IP Address Geography**

Местоположение пользователя, вычисляется на основании IP-адреса. Данная иерархия содержит точную географическую информацию о _Region_ и _Country_ с _Country Subdivision_ и _City_.





Geography

**Timezone**

Часовой пояс пользователя, определяется на основе IP-адреса пользователя, например: _Europe/Berlin_, _America/Chicago_





Geography

**Business Region**

Бизнес-регион в **User Country**, например: _European Union_, _Latin America_





Geography

**Payment System Country**

Страна происхождения платежной системы





Geography

**Issuing Bank Country**

Страна банка, выпустившего карту польззователя





Currencies

**Payment Currency**

Валюта платежа пользователя, 3-буквенное обозначение, вида: _USD_, _EUR_





Currencies

**Payout Currency**

Валюта выплаты банку-партнеру, 3-буквенное обозначение, вида: _USD_, _EUR_





Purchase

**Purchase Type**

Модуль Xsolla, использованный для совершения платежа: _Virtual Items_, _Virtual Currency_





Purchase

**Is First Payment**

_True_, если это первый платеж для данного юзера, _false_ в противном случае





Credit Cards

**Is Credit Card**

_True_, если платеж совершен через кредитную карту, _false_ в противном случае





Credit Cards

**Issuing Bank**

Банк, выпустивший кредитную карту





Credit Cards

**Credit Card Brand**

e.g _VISA_, _MasterCard_





Credit Cards

**Credit Card Type**

e.g. _CREDIT_, _DEBIT_





Credit Cards

**Credit Card Category**

e.g. _CLASSIC_, _GOLD_, _PLATINUM_





Credit Cards

**Is Payment Account Saved**

_True_ если пользователь позволил Xsolla сохранить его платежную информацию для будущих покупок, _false_ в противном случае





Credit Cards

**Is Payment From Saved Account**

_True_, если платеж был совершен с использованием сохраненной ранее платежной информации пользователя, _false_ в противном случае





Credit Cards

**Is Credit Card Rejected**

_True_, если кредитная карта была отклонена во время процесса оплаты, _false_ в противном случае. Причину отмены можно найти в измерении **Credit Card Reject Reason**





Credit Cards

**Credit Card Reject Reason**

e.g. _Insufficient Funds_, _Did not pass validation 3D-secure_





Recurring Payments

**Is Recurrent Plan Created**

_True_, если из платежа была создана рекуррентная подписка, _false_ в противном случае





Recurring Payments

**Is Recurrent Payment**

_True_, если списание с карты было совершено для оплаты рекуррентной подписки, _false_ в противном случае





User Agent

**OS**

Операционная система на девайсе пользователя, например: _Windows 8_, _MacOS_, _Android_





User Agent

**Browser**

Браузер пользователя, например: _Firefox_, _Chrome Mobile_





User Agent

**Device**

Модель мобильного устройства пользователя, например: _IPhone_, _Nokia Lumia_





User Agent

**Screen Size**

Разрешение экрана девайса пользователя





User Agent

**UI**

Интерфейс Xsolla, через который был совершен платеж, например: _PayStation_, _Smartphone Version_





Developers

**Payment Notification Delivery**

Продолжительность обработки платежа на стороне Xsolla, например: _1-3 seconds_, _1-10 minutes_





Developers

**Payment System Delay**

Продолжительность обработки платежа на стороне платежной системы, например: _1-3 seconds_, _1-10 minutes_





Developers

**Payment Flow**

Общая продолжительностьобработки платежа, например: _1-3 seconds_, _1-10 minutes_





Cancellations

**Is Cancelled**

_True_, если платеж отменен, _false_ в противном случае. Причины отмены можно найти в измерении **Cancellation Type**





Cancellations

**Cancellation Type**

Причины отмены транзакции, например: _Refund_, _Chargeback_







Метрики

Метрики, в отличие измерений, представляют собой значения, которые отображаются на графиках. Примеры метрик: **Revenue**, **Paying Users**, **Conversion**, **Average Payments Amount**.







Группа

Название

Описание









Measures

**Revenue**

Сумма до вычета комиссий. Сумма конвертируется в валюту метрики по актуальному на дату уведомления проекта курсу .





Measures

**Average Payment Amount**

**Revenue**, деленное количество **Payments**





Measures

**Gross Revenue**

Сумма дохода **Revenue** без учета **Cancellations Revenue** за текущий период





Measures

**Payments**

Общая сумма завершенных платежей. Платежи могут быть отменены в будущих периодах.





Measures

**Virtual Currency Amount**

Количество приобретенной виртуальной валюты. Доступно в модуле _Virtual Currency_





Measures

**ARPPU**

Average Revenue Per Paying User: **Revenue**, деленное на количество уникальных **Paying Users**. При использовании недельной или месячной агрегации **ARPPU** значительно возрастает, так как один пользователь может иметь несколько **Payments** за один период.





Measures

**Payments per Paying User**

Общее количество **Payments**, деленное на количество уникальных **Paying users**. Используется в еженедельных и ежемесячных агрегациях для аналитики частоты платежей.





Conversion

**Invoices**

Общее количество созданных заявок.





Conversion

**Users**

Общее количество пользователей, создавших **Invoice**. Пользователи, не завершившие платеж, также включены.





Measures

**Paying Users**

Количество уникальных пользователей, совершивших как минимум один **Payment**в рассматриваемый период





Conversion

**Paying Users Percent**

Процент пользователей, завершивших платеж от общего числа пользователей, создавших заявку. **Paying Users Percent** более точное преобразование метрики (по сравнению с **Paid Invoices Percent**), так как пользователь может попробовать несколько способов оплаты, прежде чем завершит платеж.





Conversion

**Paid Invoices Percent**

Процент завершенных **Payments** по отношению к общему числу **Invoices**





Conversion

**Churn Users**

Количество пользователей создавших, но не оплативших заявку.





Conversion

**Churn Users Percent**

Процент пользователей создавших, но не оплативших заявку.





Conversion

**Unpaid Invoices**

Количество заявок, которые не были завершены пользователем и не подтверждены платежной системой.





Conversion

**Unpaid Invoices Percent**

Процент **Unpaid Invoices** по отношению к общему количеству заявок





Conversion

**New Paying Users**

Количество уникальных **Paying users**, совершивших первый платеж в рассматриваемый период.





Conversion

**New Paying Users Percent**

Процент **New Paying Users** по отношению к общему числу **Paying Users**





Conversion

**Existing Paying Users**

Количество уникальных **Paying Users**, совершивших не первый платеж





Cancellations

**Cancellations**

Количество **Payments** которые были возвращены или отменены





Cancellations

**Cancellations Percent**

Процент **Cancellations** по отношению к общему числу **Payments**.





Cancellations

**Cancellations Revenue**

Количество отмененных **Payments**.





Cancellations

**Cancellations Revenue Percent**

Процент **Cancellations Revenue** по отношению к общему **Revenue**.





Developers

**Payment Notification Delivery, Seconds**

Продолжительность обработки платежа на стороне Xsolla





Developers

**Payment System Delay, Seconds**

Продолжительность обработки платежа на стороне платежной системы





Developers

**Payment Flow, Seconds**

Общая продолжительность обработки платежа







Метрики могут быть агрегированы различными способами. Ниже приведено описание каждого типа агрегации, который вы увидите на ваших дашбордах:



















**Count**

Сколько раз произошло отслеживаемое событие. По умолчанию используется для **Invoices**, **Paying Users**, и.т.д.





**Sum**

Какова общая сумма числовых значений, связанных с отслеживаемым событием. По умолчанию используется для **Gross Revenue**, **Virtual Currency Amount**, и.т.д.





**Average**

Каково среднее значение метрики. Это будет использоваться для метрик, содержащих процентные отношения, поэтому не имеет смысла использовать такую агрегацию для метрик вида **Sum**. По умолчанию используется для **Average Payment Amount**, **Churn Users Percent**, и.т.д.





**Maximum**

Каково было максимальное значение данной метрики





**Minimum**

Каково было минимальное значение данной метрики







FAQ

**Q.** Сколько это стоит?

**A.** Для партнеров Xsolla это бесплатно.

* * *

**Q.** Как я могу активировать data portal для моего аккаунта?

**A.** Вам необходимо иметь активный проект с завершенными платежами. Вы можете активировать data portal в [личном кабинете Xsolla](1)
* * *

**Q.** В каких валютах данные?

**A.** Доступно три валюты: Доллары США, Евро и российские Рубли. Также существует возможность фильтровать данные по валюте платежа.

* * *

**Q.** Как я могу загрузить свои собственные данные в [Slemma](https://slemma.com)?

**A.** Вы имеете несколько возможностей для загрузки дополнительных данных: загрузка файла с вашего компьютера или облачного хранилища, или напрямую подключиться к вашей БД. Подробная информация расположена в [базе знаний Slemma](1)
* * *

**Q.** Я обеспокоен конфиденциальностью и сохранностью моих данных.

**A.** Мы храним все данные в собственном защищенном хранилище данных Xsolla внутри изолированного приватного облака Amazon Web Service. Все данные передаются в/из хранилища через зашифрованное соединение TLC. Необработанные платежные данные недоступны в [Slemma](https://slemma.com). Доступны только агреггированные данные, без персональной пользовательской информации. Мы применяем принципы наименьших привилегий, файерволлы, шифрования и других технологические и эксплуатационные подходы, чтобы сохранить ваши данные в безопасности.

* * *

**Q.** В данной аналитике не хватает некотрых данных, доступных в [личном кабинете Xsolla](https://publisher.xsolla.com). Как я могу получить их в [Slemma](https://slemma.com)?

**A.** Отправьте запрос на email [dataportal@xsolla.com](1)
* * *

**Q.** Возможна ли выгрузка данных из [Slemma](https://slemma.com)?

**A.**Вы можете скачивать графики и их данные в различных форматах из [Slemma](https://slemma.com), кликнув правой кнопкой мыши по объекту и выбрав тип файла. Также вы можете скачать дашборд целиком в PDF или PNG формате. Если вам нужны необработанные данные вы можете использовать [Xsolla Reports API](http://developers.xsolla.com/api_v2.html#reports).

* * *

**Q.** Могу ли я использовать данную аналитику для проверки финансовых отчетов?

**A.** Нет, данные могут быть точны не на 100%, так как они используют среднесуточный обменных курс.

* * *

**Q.** Как часто обновляются данные?

**A.** Данные обновляются ежедневно в 2:00 AM UTC

* * *

**Q.** Насколько точны метики?

**A.** Мы получаем все метрики "на лету" из необработанных данных в нашем хранилище данных. Данный подход гарантирует точность для метрик с любой комбинацией группировки или фильтрации, особенно для подсчета количества уникальных значений или среднего метрик, к примеру, **Paying Users** и **Average Payment Amount**. Однако, мы не может предоставлять абсолютно точные финансовые данные, так как мы конвертируем платежные суммы в различный валютах со среднесуточным обменным курсом и используем округление до двух знаков после разделителя. Это означает, что разница редко превышает значение в $0.01.

* * *

**Q.** [Slemma](https://slemma.com) и аналитика в [личном кабинете Xsolla](https://publisher.xsolla.com) показывают разные значения. Почему?

**A.** Данные в [Slemma](https://slemma.com) в UTC таймзоне, тогда как данные в [личном кабинете Xsolla](https://publisher.xsolla.com) в UTC+3 таймзоне. В будущем мы собираемся убрать такое поведение и показывать все данные в UTC таймзоне.

* * *

**Q.** Как я могу пригласить другого пользователя для сотрудничества?

**A.** Когда вы активируете аналитику в [личном кабинете Xsolla](https://publisher.xsolla.com) вы можете выбрать членов вашей команды и выслать им приглашение (по умолчанию все пользователи). После регистрации в [Slemma](https://slemma.com), вы можете пригласить нового пользователя в настройках [Users and groups](https://slemma.com/team) .

* * *

**Q.** Как я могу создать свой собственный отчет?

**A.** Да, вы действительно можете сделать это!

* * *

**Q.** Какие функции обеспечивает [Slemma](https://slemma.com)?

**A.** Командный совместный доступ к дашбордам, комментирование, аннотации, управление доступом и дашборды автоматически обновляются.

* * *

**Q.** У меня есть другие вопросы о [Slemma](https://slemma.com)…

**A.** Используйте ‘Click here for help'-виджет в левой нижней стороне [Slemma](https://slemma.com) для получения доступа к базе знаний или контакта с саппортом при прмощи того же виджета.

* * *

**Q.** Как связать несколько аккаунтов в личном кабинете Xsolla со [Slemma](https://slemma.com)?

**A.** Свяжитесь с [dataportal@xsolla.com](1)
* * *

**Q.** Я не могу найти свой вопрос в данном списке…

**A.** Не стесняйтесь обращатьс к нам по любым вопросам по адресу [dataportal@xsolla.com](1)
Xsolla Network

Xsolla Network — глобальное решение, которое помогает создать бренд игры, найти новых пользователей и распространить игру через доступ к десяткам аффилированных сетей, миллионам инфлюенсеров и сотням игровых медиа-порталов из одного места. Revenue Share или кампании, основанные на CPA легко настраиваются и запускаются за несколько минут, и, поскольку Xsolla интегрирована со всеми аффилированными лицами, разработчику игры не требуется дополнительно интегрироваться. Разработчик игр могут распространять свои предложения или сообщения для инфлюенсеров и игровых платформ и платить прямо из Личного Кабинета Xsolla, без необходимости подписания соглашения с каждым из них, экономя время, деньги и ресурсы R&D.

*   Привлечение новых пользователей без предварительной оплаты;
*   Вы можете сами определять уровень рекламы, в зависимости от процента, который вы готовы платить;
*   Xsolla Network была протестирована с Life is Feudal, и показала себя эффективной;
*   4M инфлюенсеров на более чем 10 самых популярных платформах;
*   До 100 аффилированных сетей;
*   Распространение новостей во всех игровых медиа;
*   Инструменты отслеживания производительности и аналитики позволяют оценивать эффективность кампании по приобретению пользователей с помощью отслеживаемых ссылок, рекламных кодов или ключей активации продукта.
*   Базовая интеграция не обязательна, если уже интегрирован Xsolla Login.

Xsolla Network — это часть продуктовой линейки Xsolla, и может быть использована вместе с Pay Station, Mobile Pay Station и/или Pay2Play. Для использования данного продукта необходимо реализовать подключение с одним из [модулей](http://developers.xsolla.com/).

Схема взаимодействия

1) Пользователь кликает на рекламный баннер и переходит на прокси-страницу в Xsolla, на которую передается информация об игре. Xsolla сохраняет utm-параметры из URL, включая уникальный ID события (например, Click ID), и создает универсальный параметр Tracking ID для дальнейшего взаимодействия.

2) Tracking ID сохраняется в cookie-файлах пользователя, пользователь автоматически перенаправляется на промо-страницу игры.

3) Пользователь начинает процесс регистрации в игре. Игра должна сохранить Tracking ID данного пользователя вместе с его данными в базе данных игры.

4) Игра уведомляет Xsolla об успешной регистрации пользователя через API метод.

5) При получении токена для инициализации интерфейса оплаты, необходимо добавить параметр Tracking ID. Когда платеж успешно совершен, Xsolla сохраняет данные о платеже вместе с Tracking ID в базе.

6) Информация, собранная на первом шаге, плюс данные об уникальном ID события (например, Click ID) передаются источнику трафика.

Руководство по интеграции

Изменения в получении токена

Вам необходимо дополнительно передавать информацию о Tracking ID в JSON для получения токена. Tracking ID передается внутри объекта "user".

Пример запроса

        

Все параметры, которые уже присутствовали в JSON для получения токена, должны остаться без изменений.

Новый метод API

Когда пользователь с Tracking ID успешно регистрируется в игре, игра должна прислать запрос при помощи API метода.

Пример запроса

     \
    -X PUT \
    -u merchant_id:merchant_api_key







Параметр

Тип

Описание









merchant_id

int

ID мерчанта.





tracking_id

string

Tracking ID.







Пример успешного ответа

    HTTP/1.1 204 No Content

Pay2Play

Модуль **Pay2Play** позволяет разработчикам игр продавать пин-коды напрямую с сайта игры. Для перехода в магазин используется виджет Pay2Play. Модуль имеет несколько вариантов интеграции и предлагает следующие возможности:

*   Выбор платформы для каждой DRM
*   Разные цены для разных DRM
*   Выбор размера и цветовой темы виджета
*   Чаевые разработчику

Пользовательский сценарий

![](1)
Варианты интеграции

Возможны два варианта интеграции модуля — базовая и расширенная.

Базовая интеграция

![](1)
Особенности базовой интеграции:

*   Быстрый запуск модуля
*   Не требует генерации токена и наличия серверной части
*   Подходит для продажи игры без предварительной авторизации пользователя

Расширенная интеграция

![](1)
Особенности расширенной интеграции:

*   Позволяет безопасно передать данные пользователя для дальнейшей привязки покупки на стороне игры
*   Требует реализации серверной части

Руководство по базовой интеграции

Для базовой интеграции модуля необходимо:

1.  Зарегистрироваться в [Личном Кабинете Xsolla](https://publisher.xsolla.com/).
2.  [Создать проект](../pay2play.html#basic_create_project).
3.  [Настроить модуль](../pay2play.html#basic_create_module).
4.  [Протестировать](../pay2play.html#basic_testing) процесс оплаты.
5.  Добавить на страницу игры [виджет Pay2Play](../pay2play.html#basic_widget).
6.  Подписать договор.

В процессе интеграции понадобятся следующие параметры:

*   ID проекта. Отображается в URL Личного Кабинета при переходе в настройки проекта — _<span>htt</span>ps://publisher.xsolla.com/{merchant_id}/projects/{project_id}/_.

<aside class="notise2">Данное руководство включает в себя минимальный набор настроек для быстрого запуска модуля. Полный список параметров описан в [справочнике API](../api_v2.html). Если у вас возникли вопросы по подключению, пожалуйста, обратитесь к аккаунт-менеджеру проекта.</aside>

Создание проекта

1.  Перейдите в раздел **Проекты** и нажмите кнопку **Создать проект**.
2.  В настройках проекта:  

    *   Установите переключатель **HTTP оповещения** в положение **Выкл.**
    *   Установите переключатель **Беcсерверная интеграция** в положение **Вкл.**
    *   Включите модуль **Pay2Play**.

Настройка модуля

1.  Перейдите в настройки модуля **Pay2Play** и задайте базовые настройки игры:
    *   Название.
    *   Описание.
    *   Системные требования.
    *   SKU - уникальный идентификатор.
    *   Дата релиза.
    *   Изображение.
    *   DRM.
    *   Платформы, которые поддерживаются выбранными DRM.
2.  Нажмите кнопку **Далее**.
3.  Настройте цены для выбранных DRM. Нажмите кнопку **Далее**.
4.  Установите переключатель **Загруженные коды** в положение **Вкл.**
5.  Загрузите пин-коды для выбранных DRM.

Тестирование процесса оплаты

Xsolla Sandbox (“песочница”) — это автономная рабочая среда, в которой доступны все функции Live режима, кроме проведения реальных платежей. Вы можете получить доступ к Sandbox, отправив параметр _"settings.mode" = "sandbox"_ в объекте **access_data**. Параметры и структура JSON внутри объекта **access_data** идентичны JSON в запросе на получение [токена](../api_v2.html#token).

<aside class="notise2">Для проведения тестового платежа не нужен пинкод. Если вы хотите провести платеж с погашением пинкода, эту операцию необходимо выполнять в Live режиме.</aside>

Тестирование оплаты банковской картой:

1.  Откройте магазин в sandbox-режиме.
2.  Выберите предмет покупки.
3.  Выберите группу способов оплаты **Банковские карты**.
4.  Введите реквизиты тестовой карты. Остальные поля могут быть заполнены любыми данными. Вы также можете указать неверные реквизиты (номер карты, срок действия или CVV) для генерации ошибки.

[Список банковских карт для тестирования](1)
**Обратите внимание!** Платежи банковской картой в sandbox-режиме могут быть проведены только в валюте USD, EUR, RUB, GBP, SGD, HKD или THB.

Интеграция виджета Pay2Play

[Виджет Pay2Play](https://github.com/xsolla/pay2play-widget) открывает магазин в lightbox (для полноэкранной версии) или в новом окне (для мобильных устройств и планшетов). Тип устройства определяется автоматически. Для получения кода виджета откройте настройки модуля в Личном Кабинете и перейдите на вкладку **Опубликовать**. Скопируйте код нужного виджета и добавьте его на сайт игры. Рекомендуется использовать асинхронную загрузку.

Пример асинхронной загрузки

     <script>
         var access_data = {"settings":{"project_id":14004},"purchase":{"pin_codes":{"codes":[{"digital_content":"game_sku"}]}}};
         var target_element = "#widget-example-element";
         var s = document.createElement('script');
         s.type = "text/javascript";
         s.async = true;
         s.src = "//static.xsolla.com/embed/pay2play/2.1.0/widget.min.js";
         s.addEventListener('load', function (e) {
             var widgetInstance = XPay2PlayWidget.create(access_data,target_element);
         }, false);
         var head = document.getElementsByTagName('head')[0];
         head.appendChild(s);
     </script>

Полный список параметров инициализации виджета доступен в [справочнике API](../api_v2.html#pay2play_widget), инструкция по добавлению виджета — в [проекте Github](https://github.com/xsolla/pay2play-widget).

<aside class="notise2">**Обратите внимание!** Чтобы начать принимать реальные платежи, необходимо подписать договор.</aside>

Руководство по расширенной интеграции

Для расширенной интеграции модуля необходимо:

1.  Зарегистрироваться в [Личном Кабинете Xsolla](https://publisher.xsolla.com/).
2.  [Создать проект](../pay2play.html#advanced_create_project).
3.  [Настроить модуль](../pay2play.html#advanced_create_module).
4.  [Получить токен](../pay2play.html#advanced_get_token).
5.  [Настроить обработку оповещений](../pay2play.html#advanced_setup_webhooks).
6.  [Протестировать](../pay2play.html#advanced_testing) процесс оплаты.
7.  Добавить на страницу игры [виджет Pay2Play](../pay2play.html#advanced_widget) и подписать договор.

В процессе интеграции понадобятся следующие параметры:

*   ID мерчанта. Отображается в URL Личного Кабинета — _<span>ht</span>tps://publisher.xsolla.com/{merchant_id}/_.
*   Ключ API. Генерируется в Личном Кабинете в разделе **Настройки -> Компания**.
*   ID проекта. Отображается в URL Личного Кабинета при переходе в настройки проекта — _<span>htt</span>ps://publisher.xsolla.com/{merchant_id}/projects/{project_id}/_.
*   Секретный ключ проекта. Генерируется на странице настройки проекта.

<aside class="notise2">Данное руководство включает в себя минимальный набор настроек для быстрого запуска модуля. Полный список параметров описан в [справочнике API](../api_v2.html). Если у вас возникли вопросы по подключению, пожалуйста, обратитесь к аккаунт-менеджеру проекта.</aside>

Создание проекта

1.  Перейдите в раздел **Проекты** и нажмите кнопку **Создать проект**.
2.  В настройках проекта:
    *   Установите переключатель **HTTP оповещения** в положение **Вкл.**
    *   Укажите URL оповещений.
    *   Сгенерируйте секретный ключ проекта для подписи оповещений.
    *   Установите переключатель **Беcсерверная интеграция** в положение **Выкл.**
    *   Включите модуль **Pay2Play**.

Настройка модуля

1.  Перейдите в настройки модуля **Pay2Play** и задайте базовые настройки игры:
    *   Название.
    *   Описание.
    *   Системные требования.
    *   SKU - уникальный идентификатор.
    *   Дата релиза.
    *   Изображение.
    *   DRM.
    *   Платформы, которые поддерживаются выбранными DRM.
2.  Нажмите кнопку **Далее**.
3.  Настройте цены для выбранных DRM. Нажмите кнопку **Далее**.
4.  Установите переключатель **Загруженные коды** в положение **Вкл.**
5.  Загрузите пин-коды для выбранных DRM.

Получение токена магазина

Для интеграции магазина необходимо получить токен. Токен — это строка, в которой содержится информация об игре, пользователе и параметрах платежа. Xsolla API использует Basic HTTP-аутентификацию. Укажите свой ID мерчанта в качестве username и ключ API в качестве password.

Для получения доступа к sandbox-режиму используется параметр "mode" = "sandbox".

URL получения токена:

`ht<span>tps://api.xsolla.com/merchant/merchants/{merchant_id}/token</span>`

В HTTP POST запросе вы можете указать параметры, которые нужно передать на платежный интерфейс. Запрос и ответ передаются в JSON формате.

Ниже указан пример получения токена на PHP с использованием [Xsolla PHP SDK](../sdk.html). Если вы разрабатываете на другом языке, можно использовать _CURL_ пример (нажмите на кнопку CURL).

    <?php

    use Xsolla\SDK\API\XsollaClient;
    use Xsolla\SDK\API\PaymentUI\TokenRequest;

    $tokenRequest = new TokenRequest($projectId, $userId);
    $tokenRequest->setUserEmail('email@example.com')
        ->setExternalPaymentId('12345')
        ->setSandboxMode(true)
        ->setUserName('USER_NAME')
        ->setCustomParameters(array('key1' => 'value1', 'key2' => 'value2'));

    $xsollaClient = XsollaClient::factory(array(
        'merchant_id' => MERCHANT_ID,
        'api_key' => API_KEY
    ));
    $token = $xsollaClient->createPaymentUITokenFromRequest($tokenRequest);

        

Полный список параметров доступен в [справочнике API](../api_v2.html#token).

Настройка оповещений

Xsolla отправляет проекту следующие типы оповещений (webhooks):

*   Проверка существования пользователя
*   Успешный платеж
*   Отмена платежа

Чтобы подтвердить получение оповещения, ваш сервер должен вернуть 204 HTTP код без тела сообщения. Механизм работы оповещений с примерами обработки подробно описан в [справочнике API](../api_v2.html#webhooks).

Формирование подписи

Процесс формирования подписи включает следующие шаги:

1.  Данные, переданные в запросе от сервера Xsolla, и секретный ключ проекта (генерируется на странице настройки проекта) конкатенируются в строку.
2.  Полученная строка хешируется с помощью SHA1 хеш-алгоритма.
3.  Подпись передается в Signature заголовке.

При обработке оповещения необходимо проверить, что полученная подпись и подпись, переданная в Signature заголовке, совпадают.

Проверка существования пользователя

Сервер Xsolla посылает запрос на URL оповещений проекта, чтобы проверить существование персонажа в игре.

Пример запроса

    $request = array(
        'notification_type' => 'user_validation',
        'user' => array(
            'ip' => '127.0.0.1',
            'phone' => '18777976552',
            'email'=> 'email@example.com',
            'id'=> '1234567',
            'country' => 'US'
        )
    )

    

Полный список параметров доступен в [справочнике API](../api_v2.html#validate_user).

Успешный платеж

Когда пользователь завершает процесс оплаты, сервер Xsolla отправляет проекту оповещение с информацией о платеже.

Пример запроса

    $request = array(
        'notification_type' => 'payment',
        'purchase' => array(
            'virtual_items' => array(
                'items' => array(
                    0 => array(
                        'sku' => 'test_item1',
                        'amount' => 1,
                        ),
                    1 => array(
                        'sku' => 'test_item2',
                        'amount' => 1,
                        ),
                    2 => array(
                        'sku' => 'test_item3',
                        'amount' => 1,
                        ),
                )
            ),
            'total' => array(
                'currency' => 'USD',
                'amount' => 9.99
            )
        ),
        'user' => array(
            'ip' => '127.0.0.1',
            'phone' => '18777976552',
            'email' => 'email@example.com',
            'id' => '1234567',
            'country' => 'US'
        ),
        'transaction' => array(
            'id' => 87654321,
            'payment_date' => '2014-09-23T19:25:25+04:00',
            'payment_method' => 1380,
            'dry_run' => 1
        ),
        'payment_details' => array(
            'payment' => array(
                'currency' => 'USD',
                'amount' => 9.99
            ),
            'vat' => array(
                'currency' => 'USD',
                'amount' => 0
            ),
            'payout_currency_rate' => 1,
            'payout' => array(
                'currency' => 'USD',
                'amount' => 9.49
            ),
            'xsolla_fee' => array(
                'currency' => 'USD',
                'amount' => 0.19
            ),
            'payment_method_fee' => array(
                'currency' => 'USD',
                'amount' => 0.31
            )
        )
    )

    

Полный список параметров доступен в [справочнике API](../api_v2.html#payment).

Отмена платежа

Если пользователь отменяет платеж, сервер Xsolla отправляет проекту оповещение с информацией о платеже.

Пример запроса

    $request = array(
        'notification_type' => 'refund',
        'purchase' => array(
            'virtual_currency' => array(
                'name' => 'Coins',
                'quantity' => 100,
                'currency' => 'USD',
                'amount' => 9.99
            ),
            'total' => array(
                'currency' => 'USD',
                'amount' => 9.99
            )
        ),
        'user' => array(
            'ip' => '127.0.0.1',
            'phone' => '18777976552',
            'email' => 'email@example.com',
            'id' => '1234567',
            'country' => 'US'
        ),
        'transaction' => array(
            'id' => 87654321,
            'payment_date' => '2014-09-23T19:25:25+04:00',
            'payment_method' => 1380,
            'dry_run' => 1
        ),
        'refund_details' => (
                'code' => 1,
                'reason' => 'Fraud'
        ),
        'payment_details' => array(
            'payment' => array(
                'currency' => 'USD',
                'amount' => 9.99
            ),
            'vat' => array(
                'currency' => 'USD',
                'amount' => 0
            ),
            'payout_currency_rate' => 1,
            'payout' => array(
                'currency' => 'USD',
                'amount' => 9.49
            ),
            'xsolla_fee' => array(
                'currency' => 'USD',
                'amount' => 0.19
            ),
            'payment_method_fee' => array(
                'currency' => 'USD',
                'amount' => 0.31
            )
        )
    );

    

Полный список параметров доступен в [справочнике API](../api_v2.html#refund).

Тестирование оповещений

Чтобы протестировать обработчик оповещений:

1.  Откройте настройки модуля в Личном Кабинете.
2.  Перейдите на вкладку **Тестирование**.
3.  Введите тестовые данные и нажмите кнопку **Запустить тесты**: сервер Xsolla отправит все типы оповещений.
4.  Если скрипт вернул корректный ответ, тест помечается зеленым цветом, в случае ошибки — красным.

Тестирование процесса оплаты

Xsolla Sandbox ("песочница") — это автономная рабочая среда, в которой доступны все функции Live режима, кроме проведения реальных платежей. Вы можете получить доступ к Sandbox, отправив параметр _"mode" = "sandbox"_ при [получении токена](../api_v2.html#token).

<aside class="notise2">Для проведения тестового платежа не нужен пинкод. Если вы хотите провести платеж с погашением пинкода, эту операцию необходимо выполнять в Live режиме.</aside>

Тестирование оплаты банковской картой:

1.  Откройте магазин в sandbox-режиме.
2.  Выберите предмет покупки.
3.  Выберите группу способов оплаты **Банковские карты**.
4.  Введите реквизиты карты из таблицы ниже. Остальные поля могут быть заполнены любыми данными. Вы также можете указать неверные реквизиты (номер карты, срок действия или CVV) для генерации ошибки.

[Список банковских карт для тестирования](1)
**Обратите внимание!** Платежи банковской картой в sandbox-режиме могут быть проведены только в валюте USD, EUR, RUB, GBP, SGD, HKD или THB.

Интеграция виджета Pay2Play

[Виджет Pay2Play](https://github.com/xsolla/pay2play-widget) открывает магазин в lightbox (для полноэкранной версии) или в новом окне (для мобильных устройств и планшетов). Тип устройства определяется автоматически. Для получения кода виджета откройте настройки модуля в Личном Кабинете и перейдите на вкладку **Опубликовать**. Скопируйте код нужного виджета и добавьте его на сайт игры. Рекомендуется использовать асинхронную загрузку.

Пример асинхронной загрузки

     <script>
         var access_data = {"settings":{"project_id":14004},"purchase":{"pin_codes":{"codes":[{"digital_content":"game_sku"}]}}};
         var target_element = "#widget-example-element";
         var s = document.createElement('script');
         s.type = "text/javascript";
         s.async = true;
         s.src = "//static.xsolla.com/embed/pay2play/2.1.0/widget.min.js";
         s.addEventListener('load', function (e) {
             var widgetInstance = XPay2PlayWidget.create(access_data,target_element);
         }, false);
         var head = document.getElementsByTagName('head')[0];
         head.appendChild(s);
     </script>

Полный список параметров инициализации виджета доступен в [справочнике API](../api_v2.html#pay2play_widget), инструкция по добавлению виджета — в [проекте Github](https://github.com/xsolla/pay2play-widget).

<aside class="notise2">**Обратите внимание!** Чтобы начать принимать реальные платежи, необходимо подписать договор.</aside>

Дополнительные возможности

Чаевые разработчику

Проект может получать чаевые с каждой покупки. Для включения опции откройте настройки цен аддона и установите переключатель **Использовать чаевые в виджете Pay2Play** в положение **Вкл**. Для каждой добавленной валюты доступны три предустановленные суммы чаевых.

Пользователь сможет выбрать сумму чаевых перед переходом в магазин, чаевые будут добавлены к стоимости покупки.

Доставка пин-кодов пользователю по API

Вы можете отправлять пин-коды при каждой покупке игры вместо загрузки файла с пин-кодами. Для включения опции необходимо:

*   реализовать обработку оповещения [Получение пин-кода](../api_v2.html#get_pin_code);
*   в настройках аддона на вкладке **Загрузка кодов** установить переключатель **По требованию** в положение **Вкл.**, переключатель **Загруженные коды** — в положение **Выкл.**

Ограничение продаж пин-кодов

Проект может ограничить количество доступных к продаже пин-кодов. По мере продажи пин-кодов вы будете получать уведомления по электронной почте. Первое уведомление будет отправлено, когда в продаже останется не более 100 пин-кодов, второе — когда все пин-коды будут проданы. При попытке приобрести пин-коды сверх лимита проведение платежа блокируется.

![](1)
Региональные ограничения продаж

Модуль **Pay2Play** позволяет настроить региональные ограничения продажи пин-кодов:

*   задать различную стоимость для отдельных стран или групп стран;
*   запретить продажу в определенных странах.

После выполнения необходимых настроек при покупке пин-кода пользователь увидит предупреждение (если страна пользователя попадает под заданные ограничения). В странах, для которых продажа пин-кодов запрещена, проведение платежа блокируется.

![](1)
Для подключения опции обратитесь к аккаунт-менеджеру проекта. По каждой платформе, для которой необходимо настроить региональные ограничения, вам потребуется следующая информация:

*   Тип ограничения:
    *   на активацию — пин-код может быть активирован только в определенных странах;
    *   на запуск — пин-код может быть активирован в любой стране, игра может быть запущена только в определенных странах;
    *   на активацию и на запуск — активация пин-кода и запуск игры могут быть выполнены только в определенных странах.
*   Список групп стран, для которых стоимость пин-кодов будет отличаться от базовых настроек модуля.
*   Настройки для каждой группы стран:
    *   Название группы.
    *   SKU — уникальный идентификатор группы.
    *   Список цен в разных валютах. Обязательно укажите цену в валюте, выбранной в настройках модуля по умолчанию.
    *   Список стран, входящих в группу.
*   Список стран, для которых продажа пин-кодов должна быть запрещена (при необходимости).

В рамках одной платформы страна может входить только в одну из групп с настройками цен или в список стран с запретом продажи. В странах, не вошедших ни в один из списков, продажа пин-кодов будет осуществляться без каких-либо ограничений и по ценам, указанным в базовых настройках модуля.

**Обратите внимание!** Если активация пин-кодов и запуск игры выполняются на вашей стороне или на стороне платформы, в день релиза игры необходимо загружать пин-коды с уже настроенными региональными ограничениями.

Подарок другу

Вы можете дать возможность пользователям приобретать пакеты виртуальной валюты, виртуальные товары или ключи доступа в качестве подарка друзьям в игре. После успешной оплаты покупателю отправляется чек, получателю - письмо с информацией о подарке. Покупатель подарка также может скрыть свои данные и отправить подарок анонимно.

Опция имеет несколько вариантов интеграции и предлагает игровым проектам следующие варианты покупок подарка:

*   Покупка пакета виртуальной валюты
*   Покупка виртуальных товаров
*   Покупка ключа активации игры

Опция доступна только для проектов, у которых отключено хранение данных пользователей на стороне Xsolla.

Сценарии взаимодействия

Передача списка друзей в токене

![](1)
Передача списка друзей через API

![](1)
Руководство по интеграции

В зависимости от модулей, которые включены для вашего проекта, доступны следующие варианты интеграции:

Модуль Pay2Play

Для подключения модуля необходимо:

1.  [Настроить](./pay2play.html) модуль Pay2Play.
2.  Связаться с аккаунт-менеджером проекта для включения опции.

Модуль виртуальной валюты, модуль виртуальных товаров или модуль реальной валюты

Для подключения опции необходимо:

1.  Настроить модуль [виртуальной валюты](./virtual_currency.html), [виртуальных товаров](./virtual_items.html) или модуль [реальной валюты](./payment_wall.html).
2.  Реализовать [метод API](#friend_via_api) для передачи списка друзей в Xsolla или добавить объект с данными о друзьях в [запрос на получение токена](#friend_via_token).
3.  Реализовать [обработку оповещения](#setup_webhooks) об успешной оплате с добавленными данными о подарке.
4.  Связаться с аккаунт-менеджером проекта для включения опции.

Настройка модуля

Для подключения опции необходимо запустить модуль виртуальной валюты, виртуальных товаров или модуль виртуальной валюты.

Передача списка друзей в токене

При необходимости в запрос можно добавить массив со списком друзей пользователя. Если массив содержит всего один элемент, переданный друг автоматически определяется как получатель подарка. В [запросе на получение токена](./api_v2.html#token) можно передавать не более 100 друзей. В запрос также можно включить объект с данными о подарке.

**Пример запроса**

    "purchase":{

       "virtual_currency":{

           "quantity":100

       },

       "description":{

           "value":"Test Purchase"

       },

       "gift":{

           "giver_id":"John Smith",

           "message":"GG WP",

           "hide_giver_from_receiver" : true,

           "friends": [

           {

            "id": "123",

            "name": "captain",

            "email": "captain@ship.com"

           }]

       }

    }

Передача списка друзей по запросу к API

Xsolla отправляет проекту [запрос на получение списка друзей](./api_v2.html#friends_list) по адресу, указанному в качестве webhook URL в настройках проекта.

**Формирование подписи**

Процесс формирования подписи включает следующие шаги:

1.  Параметры, переданные в запросе от сервера Xsolla, сортируются в алфавитном порядке.
2.  Значения параметров и секретный ключ проекта (генерируется на странице настройки проекта) конкатенируются в строку.
3.  Полученная строка хешируется с помощью SHA1 хеш-алгоритма.
4.  Подпись передается в параметре sign.

При обработке запроса к API необходимо проверить, что полученная подпись и подпись, переданная в параметре sign, совпадают.

Получение списка друзей

**Пример запроса**

    $ 

Запуск Pay Station на домене игры

1.  Зарегистрировать новое доменное имя вида **secure.yourdomain.com**. При регистрации следует указать текущий IP-адрес домена **secure.xsolla.com** (запись типа A), либо указать алиас на **secure.xsolla.com** (запись типа CNAME).
2.  Выпустить валидный сертификат SSL для данного домена — **secure.yourdomain.com**.
3.  Генерация ключа и запроса на подпись сертификата (CSR) с использованием пакета openssl. В командной строке выполните следующие инструкции:

    *   **Генерация ключа:** _openssl genrsa -out server.key 2048_
    *   **Генерация CSR:** _openssl req -new -key server.key -out server.csr_

        Во время генерации следует отвечать на вопросы в интерактивном режиме.

        **Важно!** В поле **Common Name** нужно указать имя вашего домена (**secure.yourdomain.com**).

4.  Далее, на любом сайте, выдающем сертификаты (например, [GoDaddy](https://www.godaddy.com/web-security/ssl-certificate)) оформляется сертификат. В процессе оформления будет запрошен CSR — следует скопировать в поле ввода содержимое файла **server.csr**.

    После проверки принадлежности домена регистратор высылает подписанный сертификат.

5.  Выслать Xsolla ключ и сертификат на электронную почту [sysadmins@xsolla.com](mailto:sysadmins@xsolla.com) с темой письма: **[Ваша игра]: SSL Certificate**.
6.  При интеграции через **Pay Station Embed** необходимо указать в параметре "host" ссылку на интерфейс оплаты.

</div>